/*! Version: 1.0.0
Date: 2016-06-13 */

WMSLayerInfo=L.Class.extend({initialize:function(a,b){this._map=a,this._popupFunction=b,this._map.on("click",this.getFeatureInfo,this)},getFeatureInfo:function(a){this._hasPopup=!1,this._popupContent="",this._map.eachLayer(function(b){if(b.hasOwnProperty("wmsParams")){var c=this.getFeatureInfoUrl(a.latlng,b),d=L.bind(this.showGetFeatureInfo,this);$.ajax({url:c,dataType:"html",success:function(c){var e="string"==typeof c?null:c,f=JSON.parse(c);f.title=b.options.title,d(e,a.latlng,f)},error:function(a,b,c){d(c)}})}},this)},getFeatureInfoUrl:function(a,b){var c=this._map.latLngToContainerPoint(a,this._map.getZoom()),d=this._map.getSize(),e={request:"GetFeatureInfo",service:"WMS",srs:"EPSG:4326",styles:b.wmsParams.styles,transparent:b.wmsParams.transparent,version:b.wmsParams.version,format:b.wmsParams.format,bbox:b._map.getBounds().toBBoxString(),height:d.y,width:d.x,layers:b.wmsParams.layers,query_layers:b.wmsParams.layers,info_format:"application/json"};return b.wmsParams.hasOwnProperty("viewparams")&&(e.viewparams=b.wmsParams.viewparams),e["1.3.0"===e.version?"i":"x"]=c.x,e["1.3.0"===e.version?"j":"y"]=c.y,b._url+L.Util.getParamString(e,b._url,!0)},showGetFeatureInfo:function(a,b,c){if(a)return void console.log(a);var d="";if(c.features.length>0){if(this._popupFunction)d=this._popupFunction(c);else{d="<h3>"+c.title+"</h3>",d+='<table class="table table-striped">';for(var e in c.features[0].properties)d+="<tr>",d+="<td><b>"+e+"</b></td>",d+="<td>"+c.features[0].properties[e]+"</td>",d+="</tr>";d+="</table>"}this._popupContent+=d,this._hasPopup?this._map._popup.setContent(this._popupContent):(L.popup({maxWidth:600,maxHeight:300,closeButton:!0,closeOnClick:!0}).setLatLng(b).setContent(d).openOn(this._map),this._hasPopup=!0)}}});
//# sourceMappingURL=Leaflet.WMSLayerInfo.min.js.map